var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;import{C as o,a as s,v as l}from"./index.da3c834b.js";import{d as r,a5 as c,k as d,o as u,i as g,l as k,j as p,m,a1 as b,a6 as h,a7 as f,a8 as y,u as v,a9 as _,e as D,a2 as w,a3 as O,h as C,F as B,aa as I}from"./vendor.f6cb48f4.js";import{i as P,d as S,f as Y,a as M}from"./index.c2480ec4.js";import{u as j}from"./useVModel.443a5019.js";var x=r({name:"ListingDetails",components:{EnvironmentOutlined:c},props:{listing:Object},setup:()=>({iconColor:P})});const L={class:"listing-details"},E={class:"listing-details__information"},V={class:"listing-details__section"},T={class:"listing-details__section"},F=m(" About this space "),W={class:"listing-details__about-items"};x.render=function(e,t,a,i,n,o){const s=d("EnvironmentOutlined"),l=d("router-link"),r=d("a-divider"),c=d("a-typography-paragraph"),h=d("a-typography-title"),f=d("a-avatar"),y=d("a-tag");return u(),g("div",L,[k("div",{class:"listing-details__image",style:{backgroundImage:`url(${e.listing.image})`}},null,4),k("div",E,[k(c,{type:"secondary",class:"listing-details__city-address"},{default:p((()=>[k(l,{to:`/listings/${e.listing.city}`},{default:p((()=>[k(s,{style:{color:e.iconColor}},null,8,["style"]),m(" "+b(e.listing.city),1)])),_:1},8,["to"]),k(r,{type:"vertical"}),m(" "+b(e.listing.address),1)])),_:1}),k(h,{level:3,class:"listing-details__title"},{default:p((()=>[m(b(e.listing.title),1)])),_:1})]),k(r),k("div",V,[k(l,{to:`/user/${e.listing.host.id}`},{default:p((()=>[k(f,{src:e.listing.host.avatar,size:64},null,8,["src"]),k(h,{level:2,class:"listing-details__host-name"},{default:p((()=>[m(b(e.listing.host.name),1)])),_:1})])),_:1},8,["to"])]),k(r),k("div",T,[k(h,{level:4},{default:p((()=>[F])),_:1}),k("div",W,[k(y,{color:"magenta"},{default:p((()=>[m(b(e.listing.type),1)])),_:1}),k(y,{color:"magenta"},{default:p((()=>[m(b(e.listing.numOfGuests),1)])),_:1})]),k(c,null,{default:p((()=>[m(b(e.listing.description),1)])),_:1})])])};var $=r({name:"ListingBookings",props:{listingBookings:Object,bookingsPage:Number,limit:Number},emits:["update:bookingsPage"],setup:(e,{emit:t})=>({setBookingsPage:function(e){t("update:bookingsPage",e)}})});const A={class:"listing-bookings"},N={class:"listing-bookings__section"},U=m(" Booking "),z={class:"listing-bookings__bookings-history"},q=m(" Check in: "),J=m(" Check out: ");$.render=function(e,t,a,i,n,o){const s=d("a-divider"),l=d("a-typography-title"),r=d("a-typography-text"),c=d("a-avatar"),h=d("router-link"),f=d("a-list-item"),y=d("a-list");return u(),g("div",A,[k(s),k("div",N,[k(l,{class:"listing-bookings__title",level:4},{default:p((()=>[U])),_:1})]),k(y,{grid:{gutter:8,xs:1,sm:2,lg:3},"data-source":e.listingBookings.result,locale:{emptyText:"No bookings have been made yet!"},pagination:{current:e.bookingsPage,total:e.listingBookings.total,defaultPageSize:e.limit,hideOnSinglePage:!0,showLessItems:!0,onChange:e.setBookingsPage}},{renderItem:p((({item:e})=>[k(f,{class:"listing-bookings__item"},{default:p((()=>[k("div",z,[k("div",null,[q,k(r,{strong:""},{default:p((()=>[m(b(e.checkIn),1)])),_:2},1024)]),k("div",null,[J,k(r,{strong:""},{default:p((()=>[m(b(e.checkOut),1)])),_:2},1024)])]),k(h,{to:`/user/${e.tenant.id}`},{default:p((()=>[k(c,{src:e.tenant.avatar,size:64},null,8,["src"])])),_:2},1032,["to"])])),_:2},1024)])),_:1},8,["data-source","pagination"])])};var K=r({name:"ListingCreateBooking",props:{price:Number,checkInDate:Object,checkOutDate:Object,viewer:Object,host:Object,bookingsIndex:String},emits:["update:checkInDate","update:checkOutDate","openModal"],setup(e){const t=j(e,"checkInDate"),a=j(e,"checkOutDate"),i=JSON.parse(e.bookingsIndex),n=e.viewer.id===e.host.id,o=h((()=>!e.viewer.id||n||!e.host.hasWallet)),s=h((()=>null===t.value)),l=h((()=>null===t.value||null===a.value));let r=e.viewer.id?"You won't be charged yet":"You have to be signed in to book a listing!";n&&(r="You can't book your own listing!"),e.host.hasWallet||(r="The host has disconnected from Stripe and thus won't be able to recieve payments!");const c=h((()=>Y(e.price)));return{disabledDate:e=>{if(e){const t=e.isBefore(f().endOf("day")),a=f(e).isAfter(f().endOf("day").add(90,"days"));return t||a||(e=>{const t=e.year(),a=e.month(),n=e.date();return!(!i[t]||!i[t][a])&&Boolean(i[t][a][n])})(e)}return!1},verifyAndSetCheckOutDate:e=>{if(t.value&&e){if(f(e).isBefore(t.value,"days"))return S("You can't book date of check out to be prior to check in!");let a=t.value;for(;f(a).isBefore(e,"days");){a=f(a).add(1,"days");const e=a.year(),t=a.month(),n=a.date();if(i[e]&&i[e][t]&&i[e][t][n])return S("you can't book a period of time that overlaps existing bookings. Please try again!")}}a.value=e},buttonMessage:r,buttonDisabled:l,checkOutInputDisabled:s,checkInInputDisabled:o,checkInDateLocal:t,checkOutDateLocal:a,formatPrice:c,moment:f}}});const R={class:"listing-booking"},G=k("span",null,"/day",-1),Z={class:"listing-booking__card-date-picker"},H=m(" Check In "),Q=m(" You can only book a listing within 90 days from today. "),X={class:"listing-booking__card-date-picker"},ee=m(" Check Out "),te={class:"ant-calendar-date ant-calendar-date__check-in"},ae={key:1,class:"ant-calendar-date"},ie=m(" Checkout cannot be before check-in. "),ne=m(" Request to book! ");K.render=function(e,t,a,i,n,o){const s=d("a-typography-title"),l=d("a-typography-paragraph"),r=d("a-divider"),c=d("a-typography-text"),h=d("a-date-picker"),f=d("a-tooltip"),y=d("a-button"),v=d("a-card");return u(),g("div",R,[k(v,{class:"listing-booking__card"},{default:p((()=>[k("div",null,[k(l,null,{default:p((()=>[k(s,{level:2,class:"listing-booking__card-title"},{default:p((()=>[m(b(e.formatPrice)+" ",1),G])),_:1})])),_:1}),k(r),k("div",Z,[k(l,{strong:""},{default:p((()=>[H])),_:1}),k(h,{value:e.checkInDateLocal,"onUpdate:value":t[1]||(t[1]=t=>e.checkInDateLocal=t),"disabled-date":e.disabledDate,disabled:e.checkInInputDisabled,format:"YYYY/MM/DD","show-today":!1,onOpenChange:t[2]||(t[2]=t=>e.checkOutDateLocal=null)},{renderExtraFooter:p((()=>[k("div",null,[k(c,{type:"secondary",class:"ant-calendar-footer-text"},{default:p((()=>[Q])),_:1})])])),_:1},8,["value","disabled-date","disabled"])]),k("div",X,[k(l,{strong:""},{default:p((()=>[ee])),_:1}),k(h,{value:e.checkOutDateLocal,format:"YYYY/MM/DD","disabled-date":e.disabledDate,"show-today":!1,disabled:e.checkOutInputDisabled,onChange:e.verifyAndSetCheckOutDate},{dateRender:p((({current:t})=>[e.moment(t).isSame(e.checkInDate,"day")?(u(),g(f,{key:0,title:"Check in date"},{default:p((()=>[k("div",te,b(t.date()),1)])),_:2},1024)):(u(),g("div",ae,b(t.date()),1))])),renderExtraFooter:p((()=>[k("div",null,[k(c,{type:"secondary",class:"ant-calendar-footer-text"},{default:p((()=>[ie])),_:1})])])),_:1},8,["value","disabled-date","disabled","onChange"])])]),k(r),k(y,{size:"large",type:"primary",class:"listing-booking__card-cta",disabled:e.buttonDisabled,onClick:t[3]||(t[3]=t=>e.$emit("openModal"))},{default:p((()=>[ne])),_:1},8,["disabled"]),k(c,{type:"secondary",mark:""},{default:p((()=>[m(b(e.buttonMessage),1)])),_:1})])),_:1})])};var oe="https://js.stripe.com/v3",se=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,le="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",re=null,ce=function(e){return null!==re?re:re=new Promise((function(t,a){if("undefined"!=typeof window)if(window.Stripe&&e&&console.warn(le),window.Stripe)t(window.Stripe);else try{var i=function(){for(var e=document.querySelectorAll('script[src^="'.concat(oe,'"]')),t=0;t<e.length;t++){var a=e[t];if(se.test(a.src))return a}return null}();i&&e?console.warn(le):i||(i=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",a=document.createElement("script");a.src="".concat(oe).concat(t);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(a),a}(e)),i.addEventListener("load",(function(){window.Stripe?t(window.Stripe):a(new Error("Stripe.js not available"))})),i.addEventListener("error",(function(){a(new Error("Failed to load Stripe.js"))}))}catch(n){return void a(n)}else t(null)}))},de=function(e,t,a){if(null===e)return null;var i=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.15.0",startTime:t})}(i,a),i},ue=Promise.resolve().then((function(){return ce(null)})),ge=!1;ue.catch((function(e){ge||console.warn(e)}));var ke=r({name:"CreateBookingModal",components:{KeyOutlined:y},props:{id:String,modalVisible:Boolean,price:Number,checkInDate:Object,checkOutDate:Object},emits:["closeModal","clearBookingData"],setup(e,{emit:s}){const{mutate:l,loading:r,onDone:c,onError:d}=v(o);c((()=>{s("clearBookingData"),M("You've succesfully booked the listing!","Booking history can always be found in your User page.")})),d((()=>{S("Sorry! We were'nt able to successfully book the listing. Please try again later.")}));const u=e.checkOutDate.diff(e.checkInDate,"days")+1,g=u*e.price,k=h((()=>Y(g,!1))),p=h((()=>Y(e.price,!1)));let m,b;return _((async()=>{m=await function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];ge=!0;var i=Date.now();return ue.then((function(e){return de(e,t,i)}))}("pk_test_ljFPSJwuu8jgv5TEZfo93SUC");let e=m.elements();b=e.create("card",{hidePostalCode:!0}),b.mount("#stripe-element-mount-point")})),{loading:r,handleCreateBooking:async()=>{if(!m)return S("Sorry! We weren't able to connect with Stripe.");const{token:o,error:s}=await m.createToken(((e,o)=>{for(var s in o||(o={}))a.call(o,s)&&n(e,s,o[s]);if(t)for(var s of t(o))i.call(o,s)&&n(e,s,o[s]);return e})({},b));if(console.log(o),!o)return S(s&&s.message?s.message:"Sorry! We weren't able to book the listing. Please try again later.");l({input:{source:o.id,checkIn:e.checkInDate.format("YYYY-MM-DD"),checkOut:e.checkOutDate.format("YYYY-MM-DD"),id:e.id}})},formattedPrice:p,formattedListingPrice:k,daysBooked:u}}});const pe={class:"listing-booking-modal"},me={class:"listing-booking-modal__intro"},be=m(" Book your trip "),he=m(" Enter your payment information to book the listing between "),fe=m(" and "),ye=m(" , inclusive. "),ve={class:"listing-booking-modal__charge-summary"},_e=m(" Total = "),De={class:"listing-booking-modal__stripe-card-section"},we=k("div",{id:"stripe-element-mount-point",class:"listing-booking-modal__stripe-card"},null,-1),Oe=m(" Book "),Ce=m(" Test using the credit card number: 4242 4242 4242 4242, a future expiry date, and any 3 digits for the CVC code. ");ke.render=function(e,t,a,i,n,o){const s=d("KeyOutlined"),l=d("a-typography-title"),r=d("a-typography-text"),c=d("a-typography-paragraph"),h=d("a-divider"),f=d("a-button"),y=d("a-modal");return u(),g(y,{visible:e.modalVisible,centered:"",footer:null,onCancel:t[1]||(t[1]=t=>e.$emit("closeModal"))},{default:p((()=>[k("div",pe,[k("div",me,[k(l,{class:"listing-booking-modal__intro-title"},{default:p((()=>[k(s)])),_:1}),k(l,{class:"listing-booking-modal__intro-title",level:3},{default:p((()=>[be])),_:1}),k(c,null,{default:p((()=>[he,k(r,{strong:"",mark:""},{default:p((()=>[m(b(e.checkInDate.format("MMMM Do YYYY")),1)])),_:1}),fe,k(r,{strong:"",mark:""},{default:p((()=>[m(b(e.checkOutDate.format("MMMM Do YYYY")),1)])),_:1}),ye])),_:1})]),k(h),k("div",ve,[k(c,null,{default:p((()=>[m(b(e.formattedPrice)+" * "+b(e.daysBooked)+" days =Â  ",1),k(r,{strong:""},{default:p((()=>[m(b(e.formattedListingPrice),1)])),_:1})])),_:1}),k(c,{class:"listing-booking-modal__charge-summary-total"},{default:p((()=>[_e,k(r,{strong:"",mark:""},{default:p((()=>[m(b(e.formattedListingPrice),1)])),_:1})])),_:1})]),k(h),k("div",De,[we,k(f,{size:"large",type:"primary",class:"listing-booking-modal__cta",loading:e.loading,onClick:e.handleCreateBooking},{default:p((()=>[Oe])),_:1},8,["loading","onClick"])]),k(c,{type:"secondary"},{default:p((()=>[Ce])),_:1})])])),_:1},8,["visible"])};var Be=r({name:"PageListing",components:{ListingDetails:x,ListingBookings:$,ListingCreateBooking:K,CreateBookingModal:ke},setup(){const e=C(),t=D(1),{result:a,loading:i,error:n}=w(s,{id:e.params.id,limit:3,bookingsPage:t}),o=O(a,null,(e=>e.listing)),r=D(null),c=D(null);const d=D(!1);return{checkInDate:r,checkOutDate:c,listing:o,loading:i,error:n,bookingsPage:t,limit:3,viewer:l,modalVisible:d,clearBookingData:function(){d.value=!1,r.value=null,c.value=null,window.location.reload()}}}});Be.render=function(e,t,a,i,n,o){const s=d("PageSkeleton"),l=d("ErrorBanner"),r=d("ListingDetails"),c=d("ListingBookings"),m=d("a-col"),b=d("ListingCreateBooking"),h=d("CreateBookingModal"),f=d("a-row"),y=d("a-layout-content");return u(),g(y,{class:"listings"},{default:p((()=>[e.loading?(u(),g(s,{key:0})):e.error?(u(),g(B,{key:1},[k(l,{description:"This listing may not exist or we 've encounted an error. Please try again soon."}),k(s)],64)):(u(),g(f,{key:2,gutter:24,type:"flex",justify:"space-between"},{default:p((()=>[k(m,{xs:24,lg:14},{default:p((()=>[k(r,{listing:e.listing},null,8,["listing"]),e.listing.bookings?(u(),g(c,{key:0,"listing-bookings":e.listing.bookings,"bookings-page":e.bookingsPage,limit:e.limit,"onUpdate:bookingsPage":t[1]||(t[1]=t=>e.bookingsPage=t)},null,8,["listing-bookings","bookings-page","limit"])):I("",!0)])),_:1}),k(m,{xs:24,lg:10},{default:p((()=>[k(b,{checkInDate:e.checkInDate,"onUpdate:checkInDate":t[2]||(t[2]=t=>e.checkInDate=t),checkOutDate:e.checkOutDate,"onUpdate:checkOutDate":t[3]||(t[3]=t=>e.checkOutDate=t),price:e.listing.price,viewer:e.viewer,host:e.listing.host,"bookings-index":e.listing.bookingsIndex,onOpenModal:t[4]||(t[4]=t=>e.modalVisible=!0)},null,8,["checkInDate","checkOutDate","price","viewer","host","bookings-index"])])),_:1}),e.modalVisible?(u(),g(h,{key:0,id:e.listing.id,"modal-visible":e.modalVisible,"check-in-date":e.checkInDate,"check-out-date":e.checkOutDate,price:e.listing.price,onCloseModal:t[5]||(t[5]=t=>e.modalVisible=!1),onClearBookingData:e.clearBookingData},null,8,["id","modal-visible","check-in-date","check-out-date","price","onClearBookingData"])):I("",!0)])),_:1}))])),_:1})};export default Be;
