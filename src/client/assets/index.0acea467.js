var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a;import{i as o,d as s,f as l,a as r,C as c,b as d,v as u}from"./index.f7adef75.js";import{e as g,a4 as k,l as p,o as b,j as m,m as h,k as f,n as y,a1 as v,a5 as _,a6 as D,a7 as w,u as O,a8 as P,f as I,a2 as B,a3 as C,i as S,F as Y,a9 as M}from"./vendor.1cb7f2f0.js";import{u as j}from"./useVModel.7626bf3e.js";var L=g({name:"ListingDetails",components:{EnvironmentOutlined:k},props:{listing:Object},setup:()=>({iconColor:o})});const x={class:"listing-details"},E={class:"listing-details__information"},V={class:"listing-details__section"},T={class:"listing-details__section"},W=y(" About this space "),$={class:"listing-details__about-items"};L.render=function(e,t,i,a,n,o){const s=p("EnvironmentOutlined"),l=p("router-link"),r=p("a-divider"),c=p("a-typography-paragraph"),d=p("a-typography-title"),u=p("a-avatar"),g=p("a-tag");return b(),m("div",x,[h("div",{class:"listing-details__image",style:{backgroundImage:`url(${e.listing.image})`}},null,4),h("div",E,[h(c,{type:"secondary",class:"listing-details__city-address"},{default:f((()=>[h(l,{to:`/listings/${e.listing.city}`},{default:f((()=>[h(s,{style:{color:e.iconColor}},null,8,["style"]),y(" "+v(e.listing.city),1)])),_:1},8,["to"]),h(r,{type:"vertical"}),y(" "+v(e.listing.address),1)])),_:1}),h(d,{level:3,class:"listing-details__title"},{default:f((()=>[y(v(e.listing.title),1)])),_:1})]),h(r),h("div",V,[h(l,{to:`/user/${e.listing.host.id}`},{default:f((()=>[h(u,{src:e.listing.host.avatar,size:64},null,8,["src"]),h(d,{level:2,class:"listing-details__host-name"},{default:f((()=>[y(v(e.listing.host.name),1)])),_:1})])),_:1},8,["to"])]),h(r),h("div",T,[h(d,{level:4},{default:f((()=>[W])),_:1}),h("div",$,[h(g,{color:"magenta"},{default:f((()=>[y(v(e.listing.type),1)])),_:1}),h(g,{color:"magenta"},{default:f((()=>[y(v(e.listing.numOfGuests),1)])),_:1})]),h(c,null,{default:f((()=>[y(v(e.listing.description),1)])),_:1})])])};var N=g({name:"ListingBookings",props:{listingBookings:Object,bookingsPage:Number,limit:Number},emits:["update:bookingsPage"],setup:(e,{emit:t})=>({setBookingsPage:function(e){t("update:bookingsPage",e)}})});const U={class:"listing-bookings"},z={class:"listing-bookings__section"},A=y(" Booking "),F={class:"listing-bookings__bookings-history"},q=y(" Check in: "),J=y(" Check out: ");N.render=function(e,t,i,a,n,o){const s=p("a-divider"),l=p("a-typography-title"),r=p("a-typography-text"),c=p("a-avatar"),d=p("router-link"),u=p("a-list-item"),g=p("a-list");return b(),m("div",U,[h(s),h("div",z,[h(l,{class:"listing-bookings__title",level:4},{default:f((()=>[A])),_:1})]),h(g,{grid:{gutter:8,xs:1,sm:2,lg:3},"data-source":e.listingBookings.result,locale:{emptyText:"No bookings have been made yet!"},pagination:{current:e.bookingsPage,total:e.listingBookings.total,defaultPageSize:e.limit,hideOnSinglePage:!0,showLessItems:!0,onChange:e.setBookingsPage}},{renderItem:f((({item:e})=>[h(u,{class:"listing-bookings__item"},{default:f((()=>[h("div",F,[h("div",null,[q,h(r,{strong:""},{default:f((()=>[y(v(e.checkIn),1)])),_:2},1024)]),h("div",null,[J,h(r,{strong:""},{default:f((()=>[y(v(e.checkOut),1)])),_:2},1024)])]),h(d,{to:`/user/${e.tenant.id}`},{default:f((()=>[h(c,{src:e.tenant.avatar,size:64},null,8,["src"])])),_:2},1032,["to"])])),_:2},1024)])),_:1},8,["data-source","pagination"])])};var K=g({name:"ListingCreateBooking",props:{price:Number,checkInDate:Object,checkOutDate:Object,viewer:Object,host:Object,bookingsIndex:String},emits:["update:checkInDate","update:checkOutDate","openModal"],setup(e){const t=j(e,"checkInDate"),i=j(e,"checkOutDate"),a=JSON.parse(e.bookingsIndex),n=e.viewer.id===e.host.id,o=_((()=>!e.viewer.id||n||!e.host.hasWallet)),r=_((()=>null===t.value)),c=_((()=>null===t.value||null===i.value));let d=e.viewer.id?"You won't be charged yet":"You have to be signed in to book a listing!";n&&(d="You can't book your own listing!"),e.host.hasWallet||(d="The host has disconnected from Stripe and thus won't be able to recieve payments!");const u=_((()=>l(e.price)));return{disabledDate:e=>{if(e){return e.isBefore(D().endOf("day"))||(e=>{const t=e.year(),i=e.month(),n=e.date();return!(!a[t]||!a[t][i])&&Boolean(a[t][i][n])})(e)}return!1},verifyAndSetCheckOutDate:e=>{if(t.value&&e){if(D(e).isBefore(t.value,"days"))return s("You can't book date of check out to be prior to check in!");let i=t.value;for(;D(i).isBefore(e,"days");){i=D(i).add(1,"days");const e=i.year(),t=i.month(),n=i.date();if(a[e]&&a[e][t]&&a[e][t][n])return s("you can't book a period of time that overlaps existing bookings. Please try again!")}}i.value=e},buttonMessage:d,buttonDisabled:c,checkOutInputDisabled:r,checkInInputDisabled:o,checkInDateLocal:t,checkOutDateLocal:i,formatPrice:u}}});const G={class:"listing-booking"},R=h("span",null,"/day",-1),Z={class:"listing-booking__card-date-picker"},H=y(" Check In "),Q={class:"listing-booking__card-date-picker"},X=y(" Check Out "),ee=y(" Request to book! ");K.render=function(e,t,i,a,n,o){const s=p("a-typography-title"),l=p("a-typography-paragraph"),r=p("a-divider"),c=p("a-date-picker"),d=p("a-button"),u=p("a-typography-text"),g=p("a-card");return b(),m("div",G,[h(g,{class:"listing-booking__card"},{default:f((()=>[h("div",null,[h(l,null,{default:f((()=>[h(s,{level:2,class:"listing-booking__card-title"},{default:f((()=>[y(v(e.formatPrice)+" ",1),R])),_:1})])),_:1}),h(r),h("div",Z,[h(l,{strong:""},{default:f((()=>[H])),_:1}),h(c,{value:e.checkInDateLocal,"onUpdate:value":t[1]||(t[1]=t=>e.checkInDateLocal=t),"disabled-date":e.disabledDate,disabled:e.checkInInputDisabled,format:"YYYY/MM/DD","show-today":!1,onOpenChange:t[2]||(t[2]=t=>e.checkOutDateLocal=null)},null,8,["value","disabled-date","disabled"])]),h("div",Q,[h(l,{strong:""},{default:f((()=>[X])),_:1}),h(c,{value:e.checkOutDateLocal,format:"YYYY/MM/DD","disabled-date":e.disabledDate,"show-today":!1,disabled:e.checkOutInputDisabled,onChange:e.verifyAndSetCheckOutDate},null,8,["value","disabled-date","disabled","onChange"])])]),h(r),h(d,{size:"large",type:"primary",class:"listing-booking__card-cta",disabled:e.buttonDisabled,onClick:t[3]||(t[3]=t=>e.$emit("openModal"))},{default:f((()=>[ee])),_:1},8,["disabled"]),h(u,{type:"secondary",mark:""},{default:f((()=>[y(v(e.buttonMessage),1)])),_:1})])),_:1})])};var te="https://js.stripe.com/v3",ie=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,ae="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",ne=null,oe=function(e){return null!==ne?ne:ne=new Promise((function(t,i){if("undefined"!=typeof window)if(window.Stripe&&e&&console.warn(ae),window.Stripe)t(window.Stripe);else try{var a=function(){for(var e=document.querySelectorAll('script[src^="'.concat(te,'"]')),t=0;t<e.length;t++){var i=e[t];if(ie.test(i.src))return i}return null}();a&&e?console.warn(ae):a||(a=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat(te).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(i),i}(e)),a.addEventListener("load",(function(){window.Stripe?t(window.Stripe):i(new Error("Stripe.js not available"))})),a.addEventListener("error",(function(){i(new Error("Failed to load Stripe.js"))}))}catch(n){return void i(n)}else t(null)}))},se=function(e,t,i){if(null===e)return null;var a=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.15.0",startTime:t})}(a,i),a},le=Promise.resolve().then((function(){return oe(null)})),re=!1;le.catch((function(e){re||console.warn(e)}));var ce=g({name:"CreateBookingModal",components:{KeyOutlined:w},props:{id:String,modalVisible:Boolean,price:Number,checkInDate:Object,checkOutDate:Object},emits:["closeModal","clearBookingData"],setup(e,{emit:o}){const{mutate:d,loading:u,onDone:g,onError:k}=O(c);g((()=>{o("clearBookingData"),r("You've succesfully booked the listing!","Booking history can always be found in your User page.")})),k((()=>{s("Sorry! We were'nt able to successfully book the listing. Please try again later.")}));const p=e.checkOutDate.diff(e.checkInDate,"days")+1,b=p*e.price,m=_((()=>l(b,!1))),h=_((()=>l(e.price,!1)));let f,y;return P((async()=>{f=await function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];re=!0;var a=Date.now();return le.then((function(e){return se(e,t,a)}))}("pk_test_ljFPSJwuu8jgv5TEZfo93SUC");let e=f.elements();y=e.create("card",{hidePostalCode:!0}),y.mount("#stripe-element-mount-point")})),{loading:u,handleCreateBooking:async()=>{if(!f)return s("Sorry! We weren't able to connect with Stripe.");const{token:o,error:l}=await f.createToken(((e,o)=>{for(var s in o||(o={}))i.call(o,s)&&n(e,s,o[s]);if(t)for(var s of t(o))a.call(o,s)&&n(e,s,o[s]);return e})({},y));if(console.log(o),!o)return s(l&&l.message?l.message:"Sorry! We weren't able to book the listing. Please try again later.");d({input:{source:o.id,checkIn:e.checkInDate.format("YYYY-MM-DD"),checkOut:e.checkOutDate.format("YYYY-MM-DD"),id:e.id}})},formattedPrice:h,formattedListingPrice:m,daysBooked:p}}});const de={class:"listing-booking-modal"},ue={class:"listing-booking-modal__intro"},ge=y(" Book your trip "),ke=y(" Enter your payment information to book the listing between "),pe=y(" and "),be=y(" , inclusive. "),me={class:"listing-booking-modal__charge-summary"},he=y(" Total = "),fe={class:"listing-booking-modal__stripe-card-section"},ye=h("div",{id:"stripe-element-mount-point",class:"listing-booking-modal__stripe-card"},null,-1),ve=y(" Book ");ce.render=function(e,t,i,a,n,o){const s=p("KeyOutlined"),l=p("a-typography-title"),r=p("a-typography-text"),c=p("a-typography-paragraph"),d=p("a-divider"),u=p("a-button"),g=p("a-modal");return b(),m(g,{visible:e.modalVisible,centered:"",footer:null,onCancel:t[1]||(t[1]=t=>e.$emit("closeModal"))},{default:f((()=>[h("div",de,[h("div",ue,[h(l,{class:"listing-booking-modal__intro-title"},{default:f((()=>[h(s)])),_:1}),h(l,{class:"listing-booking-modal__intro-title",level:3},{default:f((()=>[ge])),_:1}),h(c,null,{default:f((()=>[ke,h(r,{strong:"",mark:""},{default:f((()=>[y(v(e.checkInDate.format("MMMM Do YYYY")),1)])),_:1}),pe,h(r,{strong:"",mark:""},{default:f((()=>[y(v(e.checkOutDate.format("MMMM Do YYYY")),1)])),_:1}),be])),_:1})]),h(d),h("div",me,[h(c,null,{default:f((()=>[y(v(e.formattedPrice)+" * "+v(e.daysBooked)+" days =  ",1),h(r,{strong:""},{default:f((()=>[y(v(e.formattedListingPrice),1)])),_:1})])),_:1}),h(c,{class:"listing-booking-modal__charge-summary-total"},{default:f((()=>[he,h(r,{strong:"",mark:""},{default:f((()=>[y(v(e.formattedListingPrice),1)])),_:1})])),_:1})]),h(d),h("div",fe,[ye,h(u,{size:"large",type:"primary",class:"listing-booking-modal__cta",loading:e.loading,onClick:e.handleCreateBooking},{default:f((()=>[ve])),_:1},8,["loading","onClick"])])])])),_:1},8,["visible"])};var _e=g({name:"PageListing",components:{ListingDetails:L,ListingBookings:N,ListingCreateBooking:K,CreateBookingModal:ce},setup(){const e=S(),t=I(1),{result:i,loading:a,error:n}=B(d,{id:e.params.id,limit:3,bookingsPage:t}),o=C(i,null,(e=>e.listing)),s=I(null),l=I(null),r=I(!1);return{checkInDate:s,checkOutDate:l,listing:o,loading:a,error:n,bookingsPage:t,limit:3,viewer:u,modalVisible:r}}});_e.render=function(e,t,i,a,n,o){const s=p("PageSkeleton"),l=p("ErrorBanner"),r=p("ListingDetails"),c=p("ListingBookings"),d=p("a-col"),u=p("ListingCreateBooking"),g=p("CreateBookingModal"),k=p("a-row"),y=p("a-layout-content");return b(),m(y,{class:"listings"},{default:f((()=>[e.loading?(b(),m(s,{key:0})):e.error?(b(),m(Y,{key:1},[h(l,{description:"This listing may not exist or we 've encounted an error. Please try again soon."}),h(s)],64)):(b(),m(k,{key:2,gutter:24,type:"flex",justify:"space-between"},{default:f((()=>[h(d,{xs:24,lg:14},{default:f((()=>[h(r,{listing:e.listing},null,8,["listing"]),e.listing.bookings?(b(),m(c,{key:0,"listing-bookings":e.listing.bookings,"bookings-page":e.bookingsPage,limit:e.limit,"onUpdate:bookingsPage":t[1]||(t[1]=t=>e.bookingsPage=t)},null,8,["listing-bookings","bookings-page","limit"])):M("",!0)])),_:1}),h(d,{xs:24,lg:10},{default:f((()=>[h(u,{checkInDate:e.checkInDate,"onUpdate:checkInDate":t[2]||(t[2]=t=>e.checkInDate=t),checkOutDate:e.checkOutDate,"onUpdate:checkOutDate":t[3]||(t[3]=t=>e.checkOutDate=t),price:e.listing.price,viewer:e.viewer,host:e.listing.host,"bookings-index":e.listing.bookingsIndex,onOpenModal:t[4]||(t[4]=t=>e.modalVisible=!0)},null,8,["checkInDate","checkOutDate","price","viewer","host","bookings-index"])])),_:1}),e.modalVisible?(b(),m(g,{key:0,id:e.listing.id,"modal-visible":e.modalVisible,"check-in-date":e.checkInDate,"check-out-date":e.checkOutDate,price:e.listing.price,onCloseModal:t[5]||(t[5]=t=>e.modalVisible=!1)},null,8,["id","modal-visible","check-in-date","check-out-date","price"])):M("",!0)])),_:1}))])),_:1})};export default _e;
